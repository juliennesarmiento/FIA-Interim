#! /bin/bash
clear
bold=$(tput bold)
normal=$(tput sgr0)

printf "\n \033[0;30m${bold}7.3 Set Password Expiring Warning Days${normal} \n\n"
printf "Checking user account defaults: (Password Exp Warning Days)\n"
#Checks the defaults for password expiring warning days, only gets the numbers
expDays=$(grep ^PASS_WARN_AGE /etc/login.defs | grep -o '[0-9]*')
if [ $expDays -ge 7 ]; then
	printf "\e[32m$expDays Pass\e[0m\n"
else
	printf "\e[31m$expDays Fail\e[0m\n"
	printf "Please run remediation\n"
fi
#Gets existing users
USER=$(cat /etc/passwd | grep "/bin/bash" | cut -d : -f 1)
list=(${USER})
printf "Checking existing user accounts: (Password Exp Warning Days)\n"
#For loop through each existing user to check password expiring warning days
for i in "${list[@]}"
do
	day=$(chage -l $i | grep "warning" | cut -d : -f 2)
	if [ $day -ge 7 ]; then 
		printf "\e[32m$i $day Pass\e[0m\n"
	else
		printf "\e[31m$i $day Fail\e[0m\n"
		printf "Please run remediation\n"
	fi
done
