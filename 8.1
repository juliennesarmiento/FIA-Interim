#!/bin/bash

#######################

reset

if [ "$EUID" -ne 0 ] ; then
  printf "\e[31mPlease run as root!\n"
  printf "Press any key to exit\e[0m\n"
  read -n 1 -s
  exit
fi

if [ -e /etc/redhat-release ] ; then
  printf "\e[1mRunning Scan for "
  printf "$(cat /etc/redhat-release)"
  printf "\e[0m\n"
else
  printf "\e[31m\e[1mYou are not on a Red Hat System!\n"
  printf "Press any key to exit\e[0m\n"
  read -n 1 -s
  kill -9 $PPID
fi

function ctrl_C() {
  kill -9 $PPID  
}

function ctrl_Z() {
  kill -9 $PPID
}

trap ctrl_C INT
trap ctrl_Z 2 20

######################


#8.1

printf "Remediation for Warning banner."
counter=0

chmodmotd=$( stat --format '%a' /etc/motd)
chmodissue=$( stat --format '%a' /etc/issue)
chmodissuenet=$( stat --format '%a' /etc/issue.net)
#Checks if all files' chmod equals 644
printf "Checking that /etc/motd /etc/issue /etc/issue.net have chmod of 644:\n"

if [ "$chmodmotd" -eq 644 ] && [ "$chmodissue" -eq 644 ] && [ "$chmodissuenet" -eq 644 ]
then 
	printf "\e[32mNo remediation is needed\e[0m\n"
else	
	chown root:root /etc/motd; chmod 644 /etc/motd
	chown root:root /etc/issue; chmod 644 /etc/issue
	chown root:root /etc/issue.net; chmod 644 /etc/issue.net
	counter=$((counter+1))
	printf "\e[32mRemediation has been completed\e[0m\n"
fi
echo  -en "\e[0m"

mp="Authorized uses only. All activity may be \ monitored and reported."
catissue=$(cat /etc/issue)
catissuenet=$(cat /etc/issue.net)
if [ "$catissue" == "$mp" ] && [ "$catissuenet" == "$mp" ]
then
	printf "\e[32mNo remediation is needed\e[0m\n"
else
	echo "Authorized uses only. All activity may be \ monitored and reported." > /etc/issue
	echo "Authorized uses only. All activity may be \ monitored and reported." > /etc/issue.net
	counter=$((counter+1))
	printf "\e[32mRemediation has been completed\e[0m\n"
fi
echo  -en "\e[0m"

if [ $counter -gt 0 ]; then
	printf "\e[32mRemediation required\e[0m\n"
	printf "Please run remediation\n"
else
	printf "\e[32mNo remediation required\e[0m\n"
fi



printf "\e[32mCompleted!\n"
printf "Press any key to exit\e[0m\n"

#This kills the process, please remove if not needed.

read -n 1 -s
kill -9 $PPID
